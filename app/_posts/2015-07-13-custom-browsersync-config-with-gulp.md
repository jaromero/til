---
layout: post
title:  "Custom browsersync configs with Gulp"
date:   2015-07-13 20:00:00
tags:   browsersync gulp
---
_(This is mostly meant for gulp, but I figure it's not really hard to adapt for grunt. It should be pretty straightforward.)_

[Browsersync](http://browsersync.io) is a node utility that allows us to preview and test apps on many different browsers simultaneously. It's usually used with a file-watching utility as well, to trigger reloads when file changes are detected, and so avoid having to focus each browser and hit reload on all of them (or even picking devices up to reload those). It is even able to syncronize form data and click events, so that testing can be done much faster and in a more streamlined way.

Many [yeoman generators](http://yeoman.io/generators) now use browsersync as part of the commonly found `watch` task (whether using grunt or gulp). They provide some sane defaults to allow you to get to testing as soon and as easily as possible.

Still, I wanted to get a tiny bit more customization, because my system is a bit weird (as in, custom browser scripts and etc) and I don't want to save my special preferences into version control if I can avoid it. I also want to be able to specify a different browser to open, other than my system default (but also not force that browser on anyone else).

On the terminal, browsersync can use a custom config file (the default config is generated by doing `browser-sync init`). This is good for when using browsersync as standalone, but not good enough when I'm using gulp.

Still, having the config file is actually useful, because we're now going to do things with it. At the top of my gulpfile, I can do this (ES6 syntax using [Babel](babeljs.io)):

~~~js
let bsConfig;
try {
  bsConfig = require('./bs-config.js'); // or wherever it is
} catch (e) {
  bsConfig = {};
}
~~~

And further down, in the `serve` task, this is what I have:

~~~js
gulp.task('serve', ['styles', 'fonts', 'scripts'], () => {
  browserSync(Object.assign({}, bsConfig, {
    notify: false,
    server: {
      baseDir: ['.tmp', 'app'],
      routes: {
        '/bower_components': 'bower_components'
      }
    }
  }));
  // rest of the serve task ...
~~~

This lets me keep my own configuration in `bs-config.js`, maybe even outside version control, and override it in the gulpfile itself, with whatever the project actually needs.

**Note**: `Object.assign()` is an ES6 thing. If not using Babel, you can instead use [lo-dash's `assign`](https://lodash.com/docs#assign):

~~~js
gulp.task('serve', ['styles', 'fonts', 'scripts'], function (){
  assign = require('lodash.assign');
  browserSync(assign({}, bsConfig, {
    notify: false,
    server: {
      baseDir: ['.tmp', 'app'],
      routes: {
        '/bower_components': 'bower_components'
      }
    }
  }));
  // ...
~~~

(Or even [jQuery's extend](http://api.jquery.com/jQuery.extend/), if that's what floats your boat.)
